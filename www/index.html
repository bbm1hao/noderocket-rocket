<!DOCTYPE html>
<html>
<head>
  <title>Node Rockets</title>
  <!--<link rel="stylesheet" href="css/rocket.css">-->
</head>
<body>

<button onclick="deploy()">Deploy</button>
<button onclick="arm()">Arm</button>

<canvas id="myChart" width="800" height="300"></canvas>

<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="js/lib/d3.min.js"></script>
<script type="text/javascript" src="js/lib/moment.min.js"></script>
<script type="text/javascript" src="js/lib/chart.js"></script>

<script>
  var socket = io.connect();

  socket.on('hello', function(data) {
    console.log('Hello Rocket!');
  });

  socket.on('rocket-data', function(data) {
    if(myLineChart.datasets[0].points.length > 30) {
      myLineChart.removeData();
    }
    myLineChart.addData([data.pressure, data.altitude], moment().format("h:mm:ss"));
  });


  function deploy() {
    socket.emit('deploy-parachute');
  }

  function arm() {
    socket.emit('arm-parachute');
  }
</script>



<script>
  // Get the context of the canvas element we want to select
  var ctx = document.getElementById("myChart").getContext("2d");

  Chart.defaults.global.responsive = true;

  var options = {

    ///Boolean - Whether grid lines are shown across the chart
    scaleShowGridLines : true,

    //String - Colour of the grid lines
    scaleGridLineColor : "rgba(0,0,0,.05)",

    //Number - Width of the grid lines
    scaleGridLineWidth : 1,

    //Boolean - Whether the line is curved between points
    bezierCurve : true,

    //Number - Tension of the bezier curve between points
    bezierCurveTension : 0.4,

    //Boolean - Whether to show a dot for each point
    pointDot : true,

    //Number - Radius of each point dot in pixels
    pointDotRadius : 4,

    //Number - Pixel width of point dot stroke
    pointDotStrokeWidth : 1,

    //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
    pointHitDetectionRadius : 20,

    //Boolean - Whether to show a stroke for datasets
    datasetStroke : true,

    //Number - Pixel width of dataset stroke
    datasetStrokeWidth : 2,

    //Boolean - Whether to fill the dataset with a colour
    datasetFill : true,

    //String - A legend template
    legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"

  };


  var data = {
    labels: [ moment().format("h:mm:ss"),  moment().format("h:mm:ss")],
    datasets: [
      {
        label: 'Temperature',
        fillColor: "rgba(220,220,220,0.2)",
        strokeColor: "rgba(220,220,220,1)",
        pointColor: "rgba(220,220,220,1)",
        pointStrokeColor: "#fff",
        pointHighlightFill: "#fff",
        pointHighlightStroke: "rgba(220,220,220,1)",
        data: [0]
      },
      {
        label: 'Altitude',
        fillColor: "rgba(151,187,205,0.2)",
        strokeColor: "rgba(151,187,205,1)",
        pointColor: "rgba(151,187,205,1)",
        pointStrokeColor: "#fff",
        pointHighlightFill: "#fff",
        pointHighlightStroke: "rgba(151,187,205,1)",
        data: [0]
      }
    ]
  };


  var myLineChart = new Chart(ctx).Line(data, options);

  setInterval(function(){
    if(myLineChart.datasets[0].points.length > 30) {
      myLineChart.removeData();
    }
    myLineChart.addData([Math.random() * 100, Math.random()*1000], moment().format("h:mm:ss"));
  }, 500);

</script>
</body>
</html>
